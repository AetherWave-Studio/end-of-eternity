<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>End of Eternity - Music Page</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="page-music">
    <header class="site-header">
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="music.html">Music</a>
        <a href="gallery.html">Gallery</a>
        <a href="merch.html">Merch</a>
      </nav>
    </header>
  <main>
    <h2>Music</h2>
    <div id="tracks"></div>

	<h3>Listen on Spotify</h3>
		<div id="spotify-tracks"></div>
    <iframe src="https://open.spotify.com/embed/track/1qgLfV4yxkbPpNrBSZiPDH" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
  </main>
	<div style="display:inline;">	
	<img src="assets\Super Rare!-qrcode.png" style="width:100px">
  <script src="https://unpkg.com/wavesurfer.js"></script>
  </div>
  <!--<script src="https://www.paypal.com/sdk/js?client-id=ARUEbjzzrxh3OjguN1u3na5ZMzgoPITFSBRWK79mWNBMwugUIJ-_l3MmNmuHEUKSO3eJtojajEEqkWP-&currency=USD"></script>-->
  <script src="config.js"></script>
  <script>
  const spotifyEl = document.getElementById('spotify-tracks');
EOE_CONFIG.SPOTIFY.forEach(url => {
  // Extract the track ID from the URL
  const trackIdMatch = url.match(/track\/([a-zA-Z0-9]+)/);
  if (!trackIdMatch) return; // skip if no match

  const trackId = trackIdMatch[1];
  const iframe = document.createElement('iframe');
  iframe.src = `https://open.spotify.com/embed/track/${trackId}`;
  iframe.width = '100%';
  iframe.height = '80';
  iframe.frameBorder = '0';
  iframe.allowTransparency = true;
  iframe.allow = 'encrypted-media';

  spotifyEl.appendChild(iframe);
});
  const tracksEl = document.getElementById('tracks');
  EOE_CONFIG.PRODUCTS.filter(p=>p.type==='digital').forEach(p=>{
    const div = document.createElement('div');
    div.innerHTML = `
      <h4>${p.title}</h4>
      <div id="wave-${p.sku}"></div>
      <button id="play-${p.sku}">Play/Pause</button>
      <div id="paypal-${p.sku}"></div>
    `;
    tracksEl.appendChild(div);

    const ws = WaveSurfer.create({ container:'#wave-'+p.sku, waveColor:'#2fe', progressColor:'#f6a', height:80 });
    ws.load(p.download);
    document.getElementById('play-'+p.sku).onclick = ()=> ws.playPause();

    paypal.Buttons({
      createOrder: (data, actions) => actions.order.create({ purchase_units:[{ description: p.title, amount:{ value: p.price.toFixed(2) } }] }),
      onApprove: (data, actions) => actions.order.capture().then(()=> { window.location.href = p.download; })
    }).render('#paypal-'+p.sku);
  });
  </script>
</body>
</html>
